## Token

Returns a bearer token using oAuth with [Earthdata Login](https://urs.earthdata.nasa.gov) service. The token will be returned as a [JWT (JSON Web Token)](https://jwt.io/introduction/).

```endpoint
GET /token
```

### Query Parameters

| query string parameter | description |
| -----  | ----------- |
| `state={string}` | The URI to redirect to after if oAuth was successful |


#### Example request

```curl
$ curl https://example.com/token
```

#### Example response

```json
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NUb2tlbiI6IjIyMzc0YWE4MDM1M2E3ODFkYWJjYmFhZGJhOGE3ZmMwZmE1MWYzYjQzNWYxNTc4MjU2NjA0ZjFiNGQ0NTE2ODYiLCJleHAiOiIxNTQ0NDY1MDk3ODczIn0.SxFtZ7dqp9KsUSn1uTXhWis8Il8Hig8mwLANGU3cXhY"}
```

## Refresh token

Refreshes a bearer token received from oAuth with [Earthdata Login](https://urs.earthdata.nasa.gov) service. The token will be returned as a [JWT (JSON Web Token)](https://jwt.io/introduction/).

```endpoint
POST /refresh
```

### Request body

| parameter | type | required | description |
| ----- | --- | -- | ----------- |
| `token` | string | `true` | The JWT received from the `/token` endpoint to refresh |


#### Example request

```curl
$ curl --request POST https://example.com/refresh --header 'Content-Type: application/json' --data '{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NUb2tlbiI6IjIyMzc0YWE4MDM1M2E3ODFkYWJjYmFhZGJhOGE3ZmMwZmE1MWYzYjQzNWYxNTc4MjU2NjA0ZjFiNGQ0NTE2ODYiLCJleHAiOiIxNTQ0NDY1MDk3ODczIn0.SxFtZ7dqp9KsUSn1uTXhWis8Il8Hig8mwLANGU3cXhY"}'
```

#### Example response

```json
{"token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NUb2tlbiI6IjIyMzc0YWE4MDM1M2E3ODFkYWJjYmFhZGJhOGE3ZmMwZmE1MWYzYjQzNWYxNTc4MjU2NjA0ZjFiNGQ0NTE2ODYiLCJleHAiOiIxNTQ0NDcxMjk4ODEzIn0.vO6RlSRo47kkH15_muoUYNvv74fRzFxs7FlmVaarHlc"}
```

## Delete token

Delete the record for an access token received from oAuth with [Earthdata Login](https://urs.earthdata.nasa.gov) service.

```endpoint
DELETE /tokenDelete/{token}
```

`token` is the JWT containing access token information to delete

#### Example request

```curl
$ curl --request DELETE https://example.com/tokenDelete/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2Nlc3NUb2tlbiI6IjIyMzc0YWE4MDM1M2E3ODFkYWJjYmFhZGJhOGE3ZmMwZmE1MWYzYjQzNWYxNTc4MjU2NjA0ZjFiNGQ0NTE2ODYiLCJleHAiOiIxNTQ0NDY1MDk3ODczIn0.SxFtZ7dqp9KsUSn1uTXhWis8Il8Hig8mwLANGU3cXhY
```

#### Example response

```json
{"message": "Token record was deleted"}
```

## Authorization header

When a request is made to the Cumulus API, it must contain a bearer token generated by the API.

The token is generated after the user login with [Earthdata Login](https://urs.earthdata.nasa.gov) service.

The token is included in requests using the `Authorization` header.

If no token is provided, the Cumulus API server will respond with an error, requesting credentials. If an incorrect token is provided, the server will respond with a separate error noting this.

#### Authentication example

```curl
#! /bin/sh

ORIGIN=$(dirname $CUMULUS_BASEURL)
LOGIN_URL="$CUMULUS_BASEURL/token"

# create a base64 hash of your login credentials
AUTH=$(printf "$EARTHDATA_USERNAME:$EARTHDATA_PASSWORD" | base64)

# Request the Earthdata url with client id and redirect uri to use with Cumulus
AUTHORIZE_URL=$(curl -s -i ${LOGIN_URL} | grep location | sed -e "s/^location: //");

# Request an authorization grant code
TOKEN_URL=$(curl -s -i -X POST \
  -F "credentials=${AUTH}" \
  -H "Origin: ${ORIGIN}" \
  ${AUTHORIZE_URL%$'\r'} | grep Location | sed -e "s/^Location: //")

# Request the token through the CUMULUS API url that's returned from Earthdata
# Response is a JSON object of the form { token: String }
# This uses the cli tool jq to parse the JSON and get the token string
# More info on jq: https://stedolan.github.io/jq/
TOKEN=$(curl -s ${TOKEN_URL%$'\r'} | jq -r '.message.token')

echo $TOKEN
```

```python
import os

from cumulus_api import CumulusApi

CUMULUS_BASEURL = os.environ["CUMULUS_BASEURL"]
EARTHDATA_USERNAME = os.environ["EARTHDATA_USERNAME"]
EARTHDATA_PASSWORD = os.environ["EARTHDATA_PASSWORD"]

api = CumulusApi(CUMULUS_BASEURL)

token = api.login(EARTHDATA_USERNAME, EARTHDATA_PASSWORD)
print token
```

```javascript
var Cumulus = require('../../api-client-js')

var api = new Cumulus({
  baseUrl: process.env.CUMULUS_BASEURL
})

var options = {
  username: process.env.EARTHDATA_USERNAME,
  password: process.env.EARTHDATA_PASSWORD
}

api.login(options, function (err, token) {
  console.log('token', token)
})
```
